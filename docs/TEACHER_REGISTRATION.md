# Система регистрации преподавателей

## Описание

Система регистрации преподавателей через подтверждение администратором позволяет контролировать процесс добавления новых преподавателей в систему.

## Процесс регистрации

### 1. Подача заявки преподавателем

Преподаватель:
1. Переходит на страницу `/register-teacher`
2. Заполняет форму с данными:
   - **Обязательные поля:**
     - Фамилия
     - Имя
     - Email
   - **Необязательные поля:**
     - Отчество
     - Телефон
     - Учебное заведение
     - Кафедра
     - Должность
     - Дополнительная информация
3. Отправляет заявку

### 2. Уведомление администратора

После подачи заявки:
- Все активные администраторы получают email уведомление о новой заявке
- В уведомлении указываются основные данные преподавателя

### 3. Рассмотрение заявки администратором

Администратор:
1. Заходит в панель администратора (раздел "Заявки преподавателей")
2. Видит список всех заявок с фильтрацией по статусам:
   - **Ожидают** - новые заявки
   - **Одобренные** - заявки, по которым созданы аккаунты
   - **Отклоненные** - отклоненные заявки
3. Может просмотреть детали каждой заявки
4. Принимает решение:
   - **Одобрить** - создается аккаунт, отправляется письмо с временным паролем
   - **Отклонить** - заявка отклоняется, отправляется уведомление

### 4. Одобрение заявки

При одобрении:
1. Автоматически создается аккаунт преподавателя с ролью `teacher`
2. Генерируется временный пароль (12 символов)
3. Email автоматически подтверждается (`is_verified = true`)
4. Преподаватель получает письмо с:
   - Email для входа
   - Временным паролем
   - Напоминанием сменить пароль при первом входе

### 5. Отклонение заявки

При отклонении:
1. Заявка помечается как отклоненная
2. Преподаватель получает уведомление об отклонении
3. Администратор может указать причину отклонения (отображается в письме)

## API Endpoints

### Публичные endpoints

#### POST `/api/v1/teacher-applications/`
Создание заявки на регистрацию преподавателя

**Request body:**
```json
{
  "email": "teacher@example.com",
  "last_name": "Иванов",
  "first_name": "Иван",
  "middle_name": "Иванович",
  "institution": "МГУ",
  "department": "Кафедра медицины",
  "position": "Доцент",
  "phone": "+7 999 123-45-67",
  "comment": "Дополнительная информация"
}
```

### Административные endpoints (требуется роль admin)

#### GET `/api/v1/teacher-applications/`
Список всех заявок

**Query params:**
- `status_filter` (optional): `pending` | `approved` | `rejected`

#### GET `/api/v1/teacher-applications/{application_id}`
Получение конкретной заявки

#### POST `/api/v1/teacher-applications/{application_id}/approve`
Одобрение заявки и создание аккаунта

**Request body:**
```json
{
  "admin_comment": "Добро пожаловать!" // необязательно
}
```

#### POST `/api/v1/teacher-applications/{application_id}/reject`
Отклонение заявки

**Request body:**
```json
{
  "admin_comment": "Необходимы дополнительные документы" // необязательно
}
```

## Frontend маршруты

### Публичные
- `/register-teacher` - Страница регистрации преподавателей

### Административные
- `/admin` → "Заявки преподавателей" - Управление заявками

## Email уведомления

### 1. Администратору (новая заявка)
**Тема:** Новая заявка на регистрацию преподавателя

Содержит:
- ФИО преподавателя
- Email
- Учебное заведение (если указано)

### 2. Преподавателю (одобрение)
**Тема:** Ваш аккаунт преподавателя создан

Содержит:
- Email для входа
- Временный пароль
- Предупреждение о необходимости смены пароля

### 3. Преподавателю (отклонение)
**Тема:** Заявка на регистрацию

Содержит:
- Информацию об отклонении
- Комментарий администратора (если есть)

## Database Schema

### Таблица `teacher_applications`

```sql
CREATE TABLE teacher_applications (
    id UUID PRIMARY KEY,
    email VARCHAR(255) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    first_name VARCHAR(100) NOT NULL,
    middle_name VARCHAR(100),
    institution VARCHAR(255),
    department VARCHAR(255),
    position VARCHAR(100),
    phone VARCHAR(20),
    comment TEXT,
    status VARCHAR(20) NOT NULL DEFAULT 'pending',
    admin_comment TEXT,
    reviewed_by UUID REFERENCES users(id),
    reviewed_at TIMESTAMP,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW()
);
```

## Безопасность

1. **Валидация email** - проверка на существующий аккаунт и pending заявку
2. **Роли** - только администраторы могут просматривать и обрабатывать заявки
3. **Временный пароль** - сложный пароль (12 символов, буквы, цифры, спецсимволы)
4. **Email подтверждение** - автоматическое при создании аккаунта через заявку

## Миграция

Для применения изменений в базе данных:

```bash
cd backend
alembic upgrade head
```

## Примечания

- Преподаватели **не могут** самостоятельно регистрироваться - только через заявку
- Студенты по-прежнему регистрируются самостоятельно с подтверждением email
- Одна заявка на email - нельзя подать повторную заявку с тем же email, если есть pending заявка
- Администратор может оставить комментарий при одобрении или отклонении
