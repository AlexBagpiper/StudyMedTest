# Методология оценки знаний

Система использует многофакторную модель оценки, которая учитывает не только правильность ответа, но и его сложность, а также геометрическую точность в графических заданиях.

## 1. Модель взвешенной сложности

В отличие от простых тестов, где каждый вопрос равен 1 баллу, в нашей платформе используется весовые коэффициенты сложности. Это означает, что ошибка в сложном вопросе сильнее влияет на результат, но и правильный ответ дает больше преимуществ.

### Коэффициенты:
Каждому вопросу присваивается уровень сложности от 1 до 5. Множитель рассчитывается по формуле:
$$Weight = 1.0 + (Difficulty - 1) \times 0.5$$

| Сложность | Уровень | Множитель (Вес) |
| :--- | :--- | :--- |
| **1** | Базовый | 1.0 |
| **2** | Понимание | 1.5 |
| **3** | Применение | 2.0 |
| **4** | Анализ | 2.5 |
| **5** | Экспертный | 3.0 |

### Формула итогового процента (P):
$$P = \frac{\sum (\text{Балл}_i \times \text{Вес}_i)}{\sum (100 \times \text{Вес}_i)} \times 100$$
*Где $\text{Балл}_i$ — оценка за конкретный вопрос от 0 до 100.*

## 2. Оценка графических вопросов

Для проверки разметки медицинских изображений используется алгоритм сравнения полигонов.

### Ключевые метрики:
1.  **IoU (Intersection over Union)**: Отношение площади пересечения контуров студента и преподавателя к площади их объединения. Это показатель геометрической точности.
2.  **Recall (Полнота)**: Процент эталонных объектов, которые студент смог найти. Если в эталоне 10 контуров, а студент нашел 8 — полнота 0.8.
3.  **Precision (Точность)**: Доля правильных объектов среди всех нарисованных студентом. Штрафует за «лишние» пометки.

### Итоговый балл за вопрос:
$$Score = (IoU \times W_{iou} + Recall \times W_{recall} + Precision \times W_{precision}) \times 100$$
*Веса ($W$) настраиваются администратором.*

### Нюансы автоматического расчета:
*   **Порог срабатывания (IoU Threshold)**: Чтобы объект считался «найденным» (для метрик Полноты и Точности), его IoU должен быть выше порога, который установлен в настройках. Если IoU ниже порога, система считает, что студент пропустил объект или отметил не то, и обнуляет Recall/Precision для этого элемента.
*   **Частичный зачет (Partial Matching)**: Режим для сложных и крупных объектов (например, контуры тканей), где полное выделение слишком трудоемко. В этом режиме используются две простые метрики:
    1.  **Inclusion (Включение)**: «Насколько точно попал». Проверяет, что студент рисует именно внутри эталона, не выходя за границы.
    2.  **Coverage (Покрытие)**: «Сколько работы сделал». Показывает, какую часть огромного объекта студент закрасил.
*   **Условия зачета**: Объект считается найденным, если студент попал точно (например **Inclusion >= 80%**) и выделил хотя бы минимально значимую часть (например **Coverage >= 5%**).
*   **Расчет точности при частичном зачете**:
    Вместо жесткого IoU используется формула: $Accuracy = Inclusion \times Coverage^{1/\alpha}$, где $\alpha$ — коэффициент лояльности. Это позволяет получить, например, 30-45 баллов за геометрию, даже если выделена только 1/10 часть объекта, при условии точного попадания в его границы.
*   **Несоответствие типов контуров**: Если эталон нарисован детальным полигоном, а студент использует грубую рамку, показатель IoU может быть очень низким (10-20%) даже при верном расположении. В таких случаях рекомендуется включать режим частичного зачета.

## 3. Оценка текстовых вопросов

Для проверки открытых ответов используется ИИ. Процесс проходит в три этапа:

1.  **Анализ контекста**: Модель получает вопрос, ответ студента и эталон преподавателя.
2.  **Проверка по критериям**: ИИ распределяет баллы из 100 по 4 направлениям (настраивается):
    *   *Фактическая правильность* (напр. 40б).
    *   *Полнота ответа* (напр. 30б).
    *   *Медицинская терминология* (напр. 20б).
    *   *Структура и логика* (напр. 10б).
3.  **Формирование фидбека**: ИИ пишет текстовое обоснование оценки, указывая на конкретные неточности.

### Система оценки академической честности и штрафов:
Если в вопросе включены функции контроля честности, итоговый балл за ответ может быть снижен на основании многофакторного анализа.

#### 1. Плагиат (Yandex Search)
При обнаружении прямых текстовых совпадений в открытых источниках интернета и превышении порога уникальности, балл за ответ **автоматически обнуляется**.

#### 2. Детекция ИИ и уровни реагирования
Система использует двухуровневую систему порогов для обработки подозрений на использование нейросетей:

*   **Критический порог** (напр. > 80%): «Красная линия». Если вероятность использования ИИ превышает это значение, система считает нарушение доказанным. Балл **автоматически обнуляется**, игнорируя другие параметры поведения.
*   **Порог предупреждения** (напр. 50-80%): «Серая зона». В этом диапазоне система не делает поспешных выводов, а переходит к **интеллектуальному анализу совокупности факторов**.
*   **Ниже порога предупреждения**: Штрафы не применяются, индикатор в интерфейсе остается зеленым.

#### 3. Интеллектуальный анализ поведения (Проктор)
В «серой зоне» (между порогами) окончательное решение принимает ИИ-эксперт, взвешивая несколько параметров одновременно:
1.  **Стилистика текста**: Насколько структура и обороты ответа характерны для нейросетей.
2.  **Лог событий (`event_log`)**:
    *   *Переключение вкладок*: сколько раз студент покидал страницу теста.
    *   *Время отсутствия*: общее время, проведенное вне окна тестирования.
    *   *Попытки вставки*: фиксация использования буфера обмена (Ctrl+V).

**Математика штрафа:**
ИИ выставляет `integrity_score` (коэффициент честности) от **0.0** до **1.0**. Итоговый балл за ответ перемножается на этот коэффициент:
$$ResultScore = RawScore \times IntegrityScore$$

*Пример: Если студент имеет вероятность ИИ 65%, но при этом ни разу не переключил вкладку и писал ответ долго, ИИ может поставить высокий коэффициент (0.9). Если же при той же вероятности видны множественные вставки текста, коэффициент упадет (например, до 0.2).*

Такой подход позволяет защитить честных студентов с формальным стилем письма и эффективно наказывать реальных нарушителей.

Итоговый результат теста формируется как отношение фактически набранных взвешенных баллов к максимально возможным в 100 баллов. Это гарантирует, что вклад каждого вопроса в общую оценку пропорционален его сложности.

### Алгоритм расчета:

1.  **Индивидуальная оценка**: За каждый ответ (текстовый или графический) студент получает первичный балл от 0 до 100.
2.  **Применение весов**: Первичный балл умножается на коэффициент сложности вопроса (например, для сложности 5 балл умножается на 3.0).
3.  **Суммирование**:
    *   **Набранный вес**: Складываются все полученные взвешенные баллы по всем вопросам теста.
    *   **Максимальный вес**: Складываются максимально возможные взвешенные баллы (100 * коэффициент) для всех вопросов, которые были в варианте студента.
4.  **Финальный процент**: Набранная сумма делится на максимальную и переводится в 100-балльную шкалу.

Такой механизм позволяет объективно оценивать знания: даже при одинаковом количестве правильных ответов выше будет балл у того студента, который справился с более трудными заданиями.

---
