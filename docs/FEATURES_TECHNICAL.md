# Технические детали функций MedTest Platform

В этом документе описаны технические аспекты реализации ключевых функций системы.

---

## 1. Смена Email через подтверждение кодом

### Описание
Безопасная смена email пользователя реализована через двухэтапный процесс с подтверждением через код, отправляемый на новый адрес.

### Реализация
1.  **Запрос (`POST /users/me/request-email-change`)**:
    *   Генерируется 6-значный криптографически стойкий код.
    *   Код сохраняется в полях `pending_email`, `email_change_code` и `email_change_expires` модели `User`.
    *   Отправляется письмо с кодом на новый email.
2.  **Подтверждение (`POST /users/me/confirm-email-change`)**:
    *   Проверяется код и срок его действия (15 минут).
    *   После успешной проверки `email` пользователя обновляется, а временные поля очищаются.

### Безопасность
*   Прямая смена через `PUT /users/me` заблокирована в Pydantic схеме.
*   Коды подтверждения не сохраняются в логах.
*   В Dev-режиме код возвращается в API для удобства тестирования.

---

## 2. Управление преподавателями (Staff Management)

### Описание
Преподаватели (`teacher`) — это пользователи с расширенными правами, которые могут создавать контент и проверять результаты.

### Права (Permissions)
*   Управление собственными вопросами и тестами.
*   Публикация тестов.
*   Просмотр результатов студентов (только по своим тестам).
*   Доступ к аналитике.

### Создание
Создавать преподавателей могут только пользователи с ролью `admin` через:
1.  **Админ-панель** (раздел "Пользователи").
2.  **CLI** (`python create_teacher.py`).
3.  **API** (`POST /admin/users` с указанием роли).

---

## 3. Системные конфигурации (System Config)

### Описание
Многие параметры системы (веса CV-оценки, настройки LLM) хранятся в таблице `system_configs` и могут быть изменены администратором без перезапуска сервера.

### Ключевые настройки
*   `cv_evaluation_params`: Веса для IoU, Recall, Precision.
*   `llm_evaluation_params`: Провайдер (Yandex/Local), API ключи, промпты.
