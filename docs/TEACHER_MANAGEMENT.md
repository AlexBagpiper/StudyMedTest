# Управление учетными записями преподавателей

## Обзор

Учетные записи преподавателей (`teacher`) могут создаваться только администраторами системы. Преподаватели имеют права на создание вопросов, тестов и просмотр результатов студентов.

## Права преподавателей

Преподаватели имеют следующие права:
- Создание и редактирование своих вопросов
- Создание и редактирование своих тестов
- Публикация тестов для студентов
- Просмотр результатов тестирования студентов
- Просмотр списка студентов
- Доступ к аналитике по своим тестам

## Создание учетной записи преподавателя

### Через веб-интерфейс (рекомендуется)

1. Войдите в систему как администратор
2. Перейдите в раздел "Администрирование"
3. Выберите "Пользователи"
4. Нажмите кнопку "Создать преподавателя"
5. Заполните форму:
   - Email (обязательно)
   - Пароль (обязательно, минимум 6 символов)
   - Фамилия (обязательно)
   - Имя (обязательно)
   - Отчество (опционально)
   - Роль: выберите "Преподаватель"
   - Статус: "Активен" / "Неактивен"
   - Подтверждён: Да / Нет
6. Нажмите "Создать"

### Через командную строку

Для создания учетной записи преподавателя через консоль используйте скрипт:

```bash
cd backend
python create_teacher.py
```

Скрипт запросит следующие данные:
- Email
- Фамилия
- Имя
- Отчество (опционально)
- Пароль
- Подтверждение пароля

### Через API

**Endpoint:** `POST /api/v1/admin/users`

**Требуется:** Роль `admin`

**Тело запроса:**

```json
{
  "email": "teacher@example.com",
  "password": "securepassword",
  "last_name": "Иванов",
  "first_name": "Иван",
  "middle_name": "Иванович",
  "role": "teacher",
  "is_active": true,
  "is_verified": true
}
```

**Пример с curl:**

```bash
curl -X POST "http://localhost:8000/api/v1/admin/users" \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "teacher@example.com",
    "password": "securepassword",
    "last_name": "Иванов",
    "first_name": "Иван",
    "middle_name": "Иванович",
    "role": "teacher",
    "is_active": true,
    "is_verified": true
  }'
```

## Управление существующими преподавателями

### Редактирование

1. В разделе "Администрирование" → "Пользователи"
2. Найдите нужного преподавателя (можно использовать фильтр "Преподаватели")
3. Нажмите кнопку редактирования (иконка карандаша)
4. Внесите изменения
5. Нажмите "Сохранить"

**Примечание:** При редактировании пользователя пароль можно оставить пустым, если не нужно его менять.

### Деактивация

Чтобы временно заблокировать доступ преподавателя:
1. Откройте форму редактирования
2. Измените статус на "Неактивен"
3. Сохраните изменения

### Удаление

**⚠️ Внимание:** Удаление пользователя необратимо!

1. В списке пользователей найдите нужного преподавателя
2. Нажмите кнопку удаления (иконка корзины)
3. Подтвердите удаление

**Важно:** При удалении преподавателя его вопросы и тесты остаются в системе, но связь с автором теряется.

## Фильтрация и поиск

В интерфейсе управления пользователями доступны:

- **Поиск по email или ФИО** - введите текст в строку поиска
- **Фильтр по роли** - вкладки: Все, Администраторы, Преподаватели, Студенты
- **Фильтр по статусу** - через параметр запроса API: `is_active=true/false`

## API Endpoints

### Получение списка всех пользователей

```
GET /api/v1/admin/users
```

**Параметры запроса:**
- `skip` - смещение (пагинация)
- `limit` - количество записей (по умолчанию 50, максимум 100)
- `role` - фильтр по роли (admin, teacher, student)
- `search` - поиск по email, фамилии, имени
- `is_active` - фильтр по статусу (true/false)

### Получение информации о пользователе

```
GET /api/v1/admin/users/{user_id}
```

### Обновление пользователя

```
PUT /api/v1/admin/users/{user_id}
```

**Тело запроса** (все поля опциональны):

```json
{
  "email": "newemail@example.com",
  "password": "newpassword",
  "last_name": "Новая Фамилия",
  "first_name": "Новое Имя",
  "middle_name": "Новое Отчество",
  "role": "teacher",
  "is_active": true,
  "is_verified": true
}
```

### Удаление пользователя

```
DELETE /api/v1/admin/users/{user_id}
```

## Статистика

В административной панели доступна статистика:
- Общее количество пользователей
- Количество студентов
- Количество преподавателей
- Количество администраторов

Получить статистику через API:

```
GET /api/v1/admin/stats
```

## Безопасность

- Все операции с пользователями логируются в audit log
- Только пользователи с ролью `admin` могут создавать, редактировать и удалять учетные записи преподавателей
- Пароли хешируются с использованием bcrypt
- Администратор не может удалить свою собственную учетную запись

## Логирование

Все действия администратора логируются:
- Создание пользователя
- Обновление данных пользователя
- Удаление пользователя

Просмотреть логи можно в разделе "Audit Logs":

```
GET /api/v1/admin/audit-logs
```

**Фильтры:**
- `user_id` - ID пользователя, совершившего действие
- `action` - тип действия (например, "admin.create", "admin.update", "admin.delete")
- `resource_type` - тип ресурса ("user", "question", "test", и т.д.)

## Troubleshooting

### Ошибка "Email already registered"

Email уже используется другим пользователем. Используйте другой email или найдите существующего пользователя.

### Ошибка "Admin access required"

Текущий пользователь не имеет прав администратора. Убедитесь, что вы вошли как администратор.

### Ошибка "User not found"

Пользователь с указанным ID не существует. Проверьте правильность ID.

### Ошибка "Cannot delete yourself"

Администратор не может удалить свою собственную учетную запись. Используйте другую учетную запись администратора.
